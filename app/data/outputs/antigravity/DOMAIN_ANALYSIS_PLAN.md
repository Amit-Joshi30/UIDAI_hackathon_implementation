# Domain Analysis Implementation Plan

**Date:** 2026-01-18  
**Status:** AWAITING CONFIRMATION

---

## Input Data

**Source:** `outputs/data_snapshots/cleaned_uidai_snapshot_20260118_145250.csv`

**Expected Columns:**
- `pincode`, `district`, `state`
- `bio_raw_row_count`, `demo_raw_row_count`, `enroll_raw_row_count`
- `population`, `activity_per_100k`, `urban_flag`
- Additional demographic/temporal columns as available

---

## Scripts to Create (7 total)

### Domain Analysis Scripts (5)

1. **`antigravity_scripts/09_service_deserts.py`**
   - Identify rural service deserts using 50% district baseline threshold
   - Compute desert severity scores, population coverage
   - Output: metrics, summary, 3 PNGs, validation checks

2. **`antigravity_scripts/10_demand_behavior.py`**
   - Analyze service type preferences (bio/demo/enroll ratios)
   - Urban vs rural demand patterns
   - Output: metrics, summary, 3 PNGs, validation checks

3. **`antigravity_scripts/11_service_quality.py`**
   - Compute activity consistency scores
   - Identify service volatility and gaps
   - Output: metrics, summary, 3 PNGs, validation checks

4. **`antigravity_scripts/12_capacity_mismatch.py`**
   - Population vs activity imbalance detection
   - Over/under-serviced areas identification
   - Output: metrics, summary, 3 PNGs, validation checks

5. **`antigravity_scripts/13_temporal.py`**
   - Time-series analysis (if year/month available)
   - Growth/decline trends per district
   - Output: metrics, summary, 3 PNGs, validation checks

### Support Scripts (2)

6. **`antigravity_scripts/policy_simulator.py`**
   - Prototype: Input target coverage improvements
   - Output resource allocation recommendations
   - Simple prioritization logic based on domain metrics

7. **`antigravity_scripts/run_all_domains.py`**
   - Execute scripts 09-13 in sequence
   - Aggregate validation results
   - Generate domain completion summary

---

## Output Structure

```
outputs/
├── domains/
│   ├── service_deserts/
│   │   ├── service_deserts_metrics.csv       # Pincode-level
│   │   ├── service_deserts_summary.csv       # District-level
│   │   ├── validation_service_deserts.csv    # ≥3 checks
│   │   ├── service_deserts_notes.md          # Figure descriptions
│   │   └── (generated by visualizations)
│   ├── demand_behavior/
│   │   ├── demand_behavior_metrics.csv
│   │   ├── demand_behavior_summary.csv
│   │   ├── validation_demand_behavior.csv
│   │   ├── demand_behavior_notes.md
│   │   └── (generated by visualizations)
│   ├── service_quality/
│   │   ├── service_quality_metrics.csv
│   │   ├── service_quality_summary.csv
│   │   ├── validation_service_quality.csv
│   │   ├── service_quality_notes.md
│   │   └── (generated by visualizations)
│   ├── capacity_mismatch/
│   │   ├── capacity_mismatch_metrics.csv
│   │   ├── capacity_mismatch_summary.csv
│   │   ├── validation_capacity_mismatch.csv
│   │   ├── capacity_mismatch_notes.md
│   │   └── (generated by visualizations)
│   └── temporal/
│       ├── temporal_metrics.csv
│       ├── temporal_summary.csv
│       ├── validation_temporal.csv
│       ├── temporal_notes.md
│       └── (generated by visualizations)
├── figures/
│   └── domains/
│       ├── service_deserts/
│       │   ├── desert_distribution.png
│       │   ├── desert_severity_map.png
│       │   └── top_districts_deserts.png
│       ├── demand_behavior/
│       │   ├── service_type_distribution.png
│       │   ├── urban_rural_preferences.png
│       │   └── demand_intensity_heatmap.png
│       ├── service_quality/
│       │   ├── consistency_distribution.png
│       │   ├── volatility_scores.png
│       │   └── quality_by_district.png
│       ├── capacity_mismatch/
│       │   ├── mismatch_scatter.png
│       │   ├── overserved_underserved.png
│       │   └── capacity_gap_histogram.png
│       └── temporal/
│           ├── activity_trends.png
│           ├── growth_rates_map.png
│           └── seasonal_patterns.png
└── antigravity/
    └── antigravity.log (appended)
```

---

## Detailed Metrics Per Domain

### 1. Service Deserts
**Pincode Metrics:**
- `is_service_desert` (bool)
- `desert_severity_score` (deviation from district baseline)
- `priority_rank` (population-weighted severity)
- `district_activity_per_100k` (baseline)
- `relative_gap_pct`

**District Summary:**
- `total_pincodes`, `desert_count`, `desert_ratio`
- `affected_population`, `mean_severity`

### 2. Demand Behavior
**Pincode Metrics:**
- `bio_ratio`, `demo_ratio`, `enroll_ratio`
- `dominant_service_type`
- `demand_diversity_score` (Shannon entropy)
- `total_activity`

**District Summary:**
- `avg_bio_ratio`, `avg_demo_ratio`, `avg_enroll_ratio`
- `urban_vs_rural_demand_diff`
- `demand_concentration_index`

### 3. Service Quality
**Pincode Metrics:**
- `activity_consistency_score` (coefficient of variation if temporal data exists)
- `service_gap_flag` (activity below median)
- `quality_tier` (high/medium/low)

**District Summary:**
- `avg_consistency`, `pct_high_quality`
- `quality_variance`, `problematic_pincodes_count`

### 4. Capacity Mismatch
**Pincode Metrics:**
- `capacity_utilization_ratio` (activity per population percentile)
- `mismatch_type` (overserved/balanced/underserved)
- `mismatch_magnitude`

**District Summary:**
- `avg_utilization`, `overserved_count`, `underserved_count`
- `mismatch_index`

### 5. Temporal
**Pincode Metrics:**
- `activity_trend` (growth/stable/decline, if year/month available)
- `recent_activity_pct_change`
- `temporal_volatility`

**District Summary:**
- `avg_growth_rate`, `trending_pincodes_count`
- `temporal_stability_score`

---

## Validation Checks (Per Domain)

Each `validation_<domain>.csv` will contain ≥3 rows:

| check_name | result | details |
|------------|--------|---------|
| total_pincodes | PASS/FAIL | Count matches |
| no_infinite_values | PASS/FAIL | All metrics finite |
| population_coverage | PASS/FAIL | No missing population |
| metric_range_valid | PASS/FAIL | Values within expected bounds |
| district_aggregation | PASS/FAIL | Summary totals match |

---

## Policy Simulator (Prototype)

**Input:** Target improvement percentage (e.g., reduce deserts by 20%)  
**Logic:**
1. Load all domain metrics
2. Identify high-priority pincodes (desert + low quality + high mismatch)
3. Estimate resource requirements (mobile units, staff)
4. Output prioritized intervention list

**Output:** `outputs/domains/policy_recommendations.csv`

---

## Technical Specifications

- **Random Seed:** 42 (for any sampling/ranking tiebreaks)
- **Logging:** All progress to `outputs/antigravity/antigravity.log`
- **Tool-Agnostic:** Notes and reports contain no Antigravity references
- **Error Handling:** Graceful failures with informative messages
- **Runtime Estimate:** 5-8 minutes total for all domains

---

## Execution Order

1. `09_service_deserts.py`
2. `10_demand_behavior.py`
3. `11_service_quality.py`
4. `12_capacity_mismatch.py`
5. `13_temporal.py`
6. `policy_simulator.py` (uses outputs from 1-5)
7. `run_all_domains.py` (orchestrates all)

---

## Post-Execution Summary

Will include:
- Validation status for all domains
- Pincodes failing basic checks (should be zero)
- Top 5 outputs per domain (e.g., worst deserts, highest demand mismatch)
- Resource allocation recommendations from policy simulator

---

**AWAITING USER CONFIRMATION TO PROCEED**
